<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电能质量测试报告自动化生成</title>
    <link rel="stylesheet" href="./css/all.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/vue.js"></script>
    <script src="./js/axios.js"></script>

</head>
<body>
<div id="app">
    <div class="container">
        <div class="upload-card"
             @dragover.prevent="dragover"
             @drop.prevent="drop"
             @dragleave="dragleave"
             :class="{ 'drag-active': isDragging }">

            <div class="upload-icon">
                <i class="fas fa-file-excel"></i>
            </div>

            <h2>电能质量测试报告自动化生成</h2>
            <p>上传您的Xls和Docx模板，生成电能质量测试报告文件</p>

            <form @submit.prevent="uploadFile" class="upload-form">
                <input type="file" id="file" ref="file" @change="handleFileChange" accept=".xls,.xlsx" hidden>
                <label for="file" class="file-label">
                    <span v-if="!selectedFile">选择Xls文件</span>
                    <span v-else>{{ selectedFile.name }}</span>
                    <i class="fas fa-cloud-upload-alt"></i>
                </label>

                <input type="file" id="templateFile" ref="templateFile" @change="handleTemplateFileChange" accept=".docx" hidden>
                <label for="templateFile" class="file-label">
                    <span v-if="!selectedTemplateFile">选择Docx模板文件</span>
                    <span v-else>{{ selectedTemplateFile.name }}</span>
                    <i class="fas fa-cloud-upload-alt"></i>
                </label>

                <!-- 图片上传，支持多选 -->
                <input type="file" id="imageFiles" ref="imageFiles" @change="handleImagesChange" accept="image/*" multiple hidden>
                <label for="imageFiles" class="file-label">
                    <span v-if="!selectedImages.length">请按文档模板图片插入顺序依次选择图片</span>
                    <span v-else>
                        已选{{ selectedImages.length }}张图片
                        <template v-for="img in selectedImages">
                            <span style="display:inline-block;margin-left:8px;color:#5b5b5b;">{{ img.name }}</span>
                        </template>
                    </span>
                    <i class="fas fa-cloud-upload-alt"></i>
                </label>

                <button type="submit" class="submit-btn" :disabled="!selectedFile || isLoading">
                    <span v-if="!isLoading">生成报告</span>
                    <span v-else>
                            <i class="fas fa-spinner fa-spin"></i> 处理中...
                        </span>
                </button>
            </form>

            <div class="file-requirements">
                <p><i class="fas fa-info-circle"></i> 支持格式: .xls </p>
            </div>
        </div>

        <div v-if="error" class="error-message">
            <i class="fas fa-exclamation-circle"></i> {{ error }}
        </div>

        <div v-if="success" class="success-message">
            <i class="fas fa-check-circle"></i> {{ success }}
            <a v-if="downloadUrl" href="javascript:;" class="download-link" @click="downloadReport">
                <i class="fas fa-download"></i> 下载报告
            </a>

        </div>
    </div>
</div>

<script src="./js/script.js"></script>
</body>
</html>